<%= render :partial => 'website/home/internet_banner',locals: { :category_name => @category_name } %>
<section class="details">
  <div class="container">
    <div class="row">

      <%= render :partial=> 'website/home/left_filter' %>

      <div class="col-xs-12 col-sm-8 col-md-9 pagination_sec">
        <div class="row">

          <%= render :partial => 'website/home/sorting_filter' %>

          <div class="col-sm-12">
            <div id="compare_box" class="compare_box border-radius-bg affix" style="display: block;position: relative;">
             <p><i onclick="resetcomparebox()"class="fa fa-times-circle close2" aria-hidden="true"></i></p>
              <div class="row">
                  <div id="compare-box-deal-1" class="col-md-3 hidden"></div>
                  <div id="compare-box-deal-2" class="col-md-3 hidden"></div>
                 <div class="col-md-3 text-right" style="position: absolute;right: 34px;">
                   <a id="compare-deal" style="margin: 2px auto;padding: 14px;height:50px;cursor:pointer;margin-top:9px;float:right;width:113px;"class="btn_2" onclick="comparedeals()">COMPARE</a>
                 </div>
               </div>
            </div>
          </div>

          <div class="col-xs-12">
            <div class="row box-sec" id="deal-form">
              <% @dashboard_data.each do |data| %>

                  <div class="col-xs-6 col-sm-6 col-md-4">
                    <div class="border-radius-bg auto-height">
                      <div class="vertical_middle" style="overflow: hidden;">
                        <img src="<%= data['deal_image_url'] %>"  height="70" width="155" alt="">
                      </div>
                      <h5><%= data['title'].truncate(20) %></h5>
                      <ul class="description-height">
                        <!-- $<%#= data['deal_price'] %>  -->
                        <!-- <li><%#= data['download_speed'] %> Mbps Download Speed</li> -->
                        <li><%= data['short_description'].truncate(15) %></li>
                      </ul>
                      <a class="btn_more" href="<%= more_deal_details_website_home_index_path(:deal_id=> data['id']) %>"> More Details</a>
                      <div class="box_down">
                        <span class="separator_2"></span>
                        <p>price</p>
                        <h2 class="heading_price">$<%= data['deal_price'] %> <span class="light">/</span><span class="regular">mo</span></h2>
                        <p>effective price</p>
                          <h2>$<%= data['effective_price'] %> <span class="light">/</span><span class="regular">mo</span></h2>
                          <%if @current_user.present?%>
                        <%if @current_user.email_verified%>
                             <a class="order-btn" href="<%= order_website_app_users_path(:deal_id=> data['id'],:effective_price=> data['effective_price'])%>"  id=<%=data['id']%>>Order</a>
                             <%else%>
                             <a class="order-btn" href="javascript:void(0)">Verify email</a>
                        <%end%>
                        <%else%>
                        <a class="order-btn" href="<%= order_website_app_users_path(:deal_id=> data['id'],:effective_price=> data['effective_price'])%>"  id=<%=data['id']%>>Order</a>
                        <%end%>

                        <div class="checkbox checkbox-info" id="deal-checkbox">
                          <input class="comparebox-display" value="<%=data.first.last%>" onclick='showcomparebox(<%=data['id']%>)' deal_id="<%=data['id']%>" logo_url=<%=data['deal_image_url']%> id="checkbox<%=data.first.last%>" type="checkbox">
                          <label for="checkbox<%=data.first.last%>"> Add to compare </label>
                        </div>
                      </div>
                    </div>
                  </div>
              <% end %>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
    var checkedValues,dealids;
    $("#compare_box").hide();
    $( document ).ready(function() {
        dealids = [
            <%
            if @deal_ids.present?%>
            <%=
            @deal_ids.map(&:to_s).join(", ")
            %>
            <%end
            %>
        ];
        for(i=0;i<dealids.length;i++){
            $("#"+dealids[i]).addClass("btn_3");
            $("#"+dealids[i]).text("Already Ordered");
            $("#"+dealids[i]).prop("href","javascript:void(0)")
        }
        dealids=[];
    });

  function comparedeals(){
    checked=new Array();
    $(".comparebox-display:checkbox:checked").each(function(){
     checked.push($(this).attr("deal_id"));
    });
    if (checked.length==2){
      window.open("/website/home/compare_deals?deal_ids="+checked[0]+","+checked[1],"_self");
    }
    else {
      alert("Please select 2 deals to compare");
    }

  }
    $(document).ready(function () {
      checked=new Array();
        $(".comparebox-display:checked").attr("checked",false);
        $(".comparebox-display").attr("disabled",false)
        $(".comparebox-display:checkbox:checked").attr("checked", false);
        if ($(".comparebox-display:checkbox:checked").length >= 2) {
            $(".comparebox-display:checkbox").not(":checked").attr("disabled", 2);
        }
        $(".comparebox-display:checkbox").on("change",function () {
            var bol = $(".comparebox-display:checkbox:checked").length >= 2;
            $(".comparebox-display:checkbox").not(":checked").attr("disabled", bol);
       });
       if($("#compare-box-deal-1").is(":visible")==false && $("#compare-box-deal-2").is(":visible")==false) {
          $("#compare_box").hide();
       }
     });

function showcomparebox(deal_id) {
  if ($("#checkbox"+deal_id).is(":checked")==true){
    if($("#compare_box").is(":visible")==false && $("#compare-box-deal-1").is(":visible")==false){
      console.log(1);
      $("#compare-box-deal-1").removeClass("hidden");
     logo_url=$("#checkbox"+deal_id).attr("logo_url");
          $("#compare-box-deal-1").html("<div id=compare-"+deal_id+"><img src="+logo_url+" height='70' width='155'><i class='fa fa-times-circle' onclick='hideandreset("+deal_id+")' deal_id="+deal_id+" style='position:absolute;cursor:pointer;top:-4px;right:30px'></i></div>");
          $("#compare-box-deal-1").removeClass("hidden");
          $("#compare_box").show();
     }
     else if($("#compare_box").is(":visible")==true && $("#compare-box-deal-1").is(":visible")==true){
       console.log(2);
       logo_url=$("#checkbox"+deal_id).attr("logo_url");
            $("#compare-box-deal-2").html("<div id=compare-"+deal_id+"><img src="+logo_url+" height='70' width='155'><i class='fa fa-times-circle' onclick='hideandreset("+deal_id+")' deal_id="+deal_id+" style='position:absolute;cursor:pointer;top:-4px;right:30px'></i></div>");
            $("#compare-box-deal-2").removeClass("hidden");
            $("#compare-box-deal-2").show();
     }
     else if($("#compare_box").is(":visible")==true && $("#compare-box-deal-1").is(":visible")==false){
       console.log(3);
       logo_url=$("#checkbox"+deal_id).attr("logo_url");
            $("#compare-box-deal-1").html("<div id=compare-"+deal_id+"><img src="+logo_url+" height='70' width='155'><i class='fa fa-times-circle' onclick='hideandreset("+deal_id+")' deal_id="+deal_id+" style='position:absolute;cursor:pointer;top:-4px;right:30px'></i></div>");
            $("#compare-box-deal-1").removeClass("hidden");
            $("#compare-box-deal-1").show();
     }
  }
  else if($("#checkbox"+deal_id).is("checked")==false){
    div_id=$("#compare-"+deal_id).parent().attr("id");
    $("#"+div_id).addClass("hidden");
    if($("#compare-box-deal-1").is(":visible")==false && $("#compare-box-deal-2").is(":visible")==false){
        $("#compare_box").hide();
    }
  }
}

function hideandreset(deal_id){
  div_id=$("#compare-"+deal_id).parent().attr("id");
  console.log(div_id+"hidden");
  $("#"+div_id).addClass("hidden");
  $("#checkbox"+deal_id).attr("checked",false);
  if($("#compare-box-deal-1").is(":visible")==false && $("#compare-box-deal-2").is(":visible")==false){
      $("#compare_box").hide();
  }
  $(".comparebox-display:checkbox").not(":checked").attr("disabled",false);
}
function resetcomparebox() {
    $("#compare_box").hide();
    $(".comparebox-display:checked").attr("checked",false);
    $(".comparebox-display").attr("disabled",false)
    $(".comparebox-display:checkbox").attr("checked", false);
    $("#compare-box-deal-1").addClass("hidden");
    $("#compare-box-deal-2").addClass("hidden");
};
</script>
